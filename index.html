<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>New tab</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-1: #0b1020;
      --muted: #9aa8c7;
      --accent: #6ad0ff;
      --ui-radius: 28px;
      --tab-height: 78px;
    }
    
    html,body{
      height:100%;
      margin:0;
      font-family:Inter,system-ui;
      background:var(--bg-1);
      color:#e9f2ff;
      overflow:hidden;
    }
    
    #bg{
      position:fixed;
      inset:0;
      z-index:0;
      will-change: auto;
    }
    
    .container{
      position:relative;
      z-index:3;
      max-width:980px;
      margin:28px auto;
      padding:24px;
      display:flex;
      flex-direction:column;
      gap:20px;
      padding-bottom:120px;
    }

    .card{
      background:rgba(255,255,255,0.02);
      border-radius:var(--ui-radius);
      backdrop-filter:blur(8px);
      box-shadow:0 8px 24px rgba(2,8,20,.6);
      padding:18px;
    }

    .rgb-anim {
      position: relative;
      border-radius: 20px;
      padding: 3px;
      background: linear-gradient(135deg, #00f0ff, #9b6bff, #ff4fd8, #00f0ff);
      background-size: 300% 300%;
      animation: gradientShift 8s ease infinite;
      will-change: background-position;
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Search */
    .search-bar {
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:20px;
    }
    
    .search {
      flex:1;
      display:flex;
      align-items:center;
      background:rgba(15,15,20,0.9);
      padding:10px 14px;
      border-radius:14px;
      transition:transform .3s ease, box-shadow .3s ease;
      will-change: transform;
    }
    
    .search:hover {
      transform:translateY(-3px) scale(1.01);
      box-shadow:0 12px 28px rgba(0,255,200,0.3);
    }
    
    .search input{
      flex:1;
      background:transparent;
      border:0;
      color:inherit;
      font-size:16px;
      outline:none;
    }
    
    .btn{
      background:linear-gradient(180deg,var(--accent),#33c3ff);
      color:#05202a;
      padding:10px 14px;
      border-radius:12px;
      font-weight:700;
      border:0;
      cursor:pointer;
      margin-left:12px;
      transition:transform .2s;
      will-change: transform;
    }
    
    .btn:active{
      transform:scale(0.92);
    }

    /* Engine Selector */
    .engines{
      display:flex;
      gap:10px;
      margin-top:10px;
      flex-wrap:wrap;
    }
    
    .engine {
      flex:1;
      min-width:120px;
      background:rgba(255,255,255,0.05);
      border-radius:14px;
      padding:10px;
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:center;
      cursor:pointer;
      transition:transform .25s ease, box-shadow .3s ease;
      will-change: transform;
    }
    
    .engine:hover {
      transform:translateY(-6px) scale(1.05);
      box-shadow:0 12px 24px rgba(0,200,255,.4);
    }
    
    .engine:active {
      transform:scale(0.92);
    }
    
    .engine.active {
      background:linear-gradient(135deg,#9ff2ff,#55d3ff);
      color:#05202a;
      font-weight:700;
    }
    
    .engine svg{
      width:22px;
      height:22px;
      flex-shrink:0;
    }

    /* Quick Links */
    .tiles{
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 11px;
      margin-top: 1px;
      width: 100%;
    }
    
    .add-tile {
      min-width:150px;
      background:rgba(255,255,255,0.05);
      border-radius:14px;
      padding:12px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition:transform .25s ease, box-shadow .3s ease;
      border:2px dashed rgba(255,255,255,0.2);
      color:var(--muted);
      will-change: transform;
    }
    
    .add-tile:hover {
      transform:translateY(-6px) scale(1.05);
      box-shadow:0 12px 24px rgba(0,200,255,.3);
      border-color:var(--accent);
      color:#fff;
    }
    
    .add-tile svg {
      width:24px;
      height:24px;
      flex-shrink:0;
    }
    
    /* Modal Styles */
    .modal-overlay {
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.7);
      display:none;
      justify-content:center;
      align-items:center;
      z-index:1000;
      backdrop-filter:blur(8px);
    }
    
    .modal-overlay.show {
      display:flex;
    }
    
    .modal {
      background:rgba(15,15,25,0.95);
      border-radius:var(--ui-radius);
      padding:24px;
      width:min(400px, 90%);
      border:1px solid rgba(255,255,255,0.1);
      box-shadow:0 20px 40px rgba(0,0,0,0.5);
    }
    
    .modal h3 {
      margin:0 0 20px 0;
      color:#fff;
    }
    
    .modal-form {
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    
    .form-group {
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    
    .form-group label {
      color:var(--muted);
      font-size:14px;
      font-weight:600;
    }
    
    .form-group input {
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.1);
      border-radius:8px;
      padding:12px;
      color:#fff;
      font-size:14px;
    }
    
    .form-group input:focus {
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 2px rgba(106,208,255,0.2);
    }
    
    .modal-buttons {
      display:flex;
      gap:12px;
      justify-content:flex-end;
      margin-top:8px;
    }
    
    .modal-btn {
      padding:10px 20px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-weight:600;
      transition:transform .2s;
    }
    
    .modal-btn.primary {
      background:linear-gradient(180deg,var(--accent),#33c3ff);
      color:#05202a;
    }
    
    .modal-btn.secondary {
      background:rgba(255,255,255,0.1);
      color:#fff;
    }
    
    .modal-btn:hover {
      transform:scale(1.05);
    }
    
    .modal-btn:active {
      transform:scale(0.95);
    }
    
    .delete-btn {
      position:absolute;
      top:8px;
      right:8px;
      background:rgba(255,59,48,0.8);
      border:none;
      border-radius:50%;
      width:24px;
      height:24px;
      cursor:pointer;
      display:none;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-size:12px;
      transition:transform .2s;
    }
    
    .tile-ring:hover .delete-btn {
      display:flex;
    }
    
    .delete-btn:hover {
      transform:scale(1.1);
      background:rgba(255,59,48,1);
    }
    
    .tile-ring {
      border-radius:16px;
      padding:3px;
      background: linear-gradient(135deg, #00f0ff, #9b6bff, #ff4fd8, #00f0ff);
      background-size: 300% 300%;
      animation: gradientShift 8s ease infinite;
      will-change: background-position;
      text-decoration: none;
      position: relative;
    }
    
    .tile {
      min-width:150px;
      background:rgba(255,255,255,0.05);
      border-radius:14px;
      padding:12px;
      display:flex;
      gap:10px;
      align-items:center;
      transition:transform .25s ease, box-shadow .3s ease;
      transform-style:preserve-3d;
      will-change: transform;
    }
    
    .tile:hover{
      transform:translateY(-10px) rotateX(6deg) rotateY(-6deg) scale(1.05);
      box-shadow:0 20px 40px rgba(0,200,255,.35);
    }
    
    .tile:active{
      transform:scale(0.92);
    }
    
    .tile svg{
      width:38px;
      height:38px;
      flex-shrink:0;
      filter:drop-shadow(0 0 6px rgba(255,255,255,0.2));
      display: none;
    }
    
    .tile .meta{
      display:flex;
      flex-direction:column;
    }
    
    .tile .meta .name{
      font-weight:700;
      color: inherit;
    }
    
    .tile .meta .desc{
      font-size:12px;
      color:var(--muted);
    }

    /* Enhanced Search Bar Styles */
    .search-bar {
      position: relative;
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .search {
      flex: 1;
      position: relative;
    }

    .search input {
      width: 100%;
      padding: 16px 20px;
      background: rgba(255,255,255,0.08);
      border: 2px solid transparent;
      border-radius: 16px;
      color: #fff;
      font-size: 15px;
      font-weight: 500;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .search input:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(255,255,255,0.12);
      box-shadow: 0 8px 32px rgba(106,208,255,0.2);
      transform: translateY(-2px);
    }

    .search input::placeholder {
      color: rgba(255,255,255,0.5);
      font-weight: 400;
    }

    .btn {
      padding: 16px 24px;
      background: linear-gradient(135deg, var(--accent), #33c3ff);
      border: none;
      border-radius: 16px;
      color: #05202a;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 20px rgba(106,208,255,0.3);
      min-width: 120px;
    }

    .btn:hover {
      background: linear-gradient(135deg, #33c3ff, var(--accent));
      transform: translateY(-4px);
      box-shadow: 0 8px 32px rgba(106,208,255,0.4);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn.secondary {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: #fff;
      margin-left: 8px;
    }

    .btn.secondary:hover {
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.3);
    }

    /* Playlist Styles */
    .playlist-search {
      margin-bottom: 24px;
    }

    .playlist-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 16px;
      max-height: 70vh;
      overflow-y: auto;
      padding-right: 8px;
    }

    /* Scrollbar styling */
    .playlist-grid::-webkit-scrollbar {
      width: 8px;
    }

    .playlist-grid::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
    }

    .playlist-grid::-webkit-scrollbar-thumb {
      background: rgba(106,208,255,0.3);
      border-radius: 10px;
    }

    .playlist-grid::-webkit-scrollbar-thumb:hover {
      background: rgba(106,208,255,0.5);
    }

    /* Scroll indicator */
    .scroll-indicator {
      position: absolute;
      bottom: 10px;
      right: 20px;
      background: rgba(106,208,255,0.2);
      color: rgba(106,208,255,0.8);
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .playlist-container {
      position: relative;
    }

    .playlist-container.scrollable .scroll-indicator {
      opacity: 1;
    }

    /* Playlist actions */
    .playlist-actions {
      padding: 12px 16px;
      border-top: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: center;
    }

    /* Fixed playlist card sizing */
    .playlist-card {
      min-height: 200px;
      transition: all 0.3s ease;
    }

    .playlist-card:not(.expanded) {
      height: 200px;
      overflow: hidden;
    }

    .show-all-btn {
      background: rgba(106,208,255,0.1);
      border: 1px solid rgba(106,208,255,0.3);
      color: rgba(106,208,255,0.9);
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .show-all-btn:hover {
      background: rgba(106,208,255,0.2);
      border-color: rgba(106,208,255,0.5);
      color: #6ad0ff;
      transform: translateY(-1px);
    }

    /* Expanded playlist styling */
    .playlist-card.expanded .video-grid {
      max-height: none;
    }

    .playlist-card.expanded {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(106,208,255,0.3);
    }

    /* Playlist header improvements */
    .playlist-header {
      transition: background 0.3s ease;
      position: relative;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
    }

    .playlist-header:hover {
      background: rgba(255,255,255,0.03);
    }

    .playlist-info {
      flex: 1;
    }

    .first-song-title {
      color: var(--muted);
      font-size: 13px;
      margin-top: 4px;
    }

    .playlist-controls {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .play-all-btn {
      background: rgba(106,208,255,0.2);
      border: 1px solid rgba(106,208,255,0.4);
      color: #6ad0ff;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .play-all-btn:hover {
      background: rgba(106,208,255,0.3);
      transform: scale(1.1);
    }

    .expand-btn {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: #fff;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .expand-btn:hover {
      background: rgba(255,255,255,0.15);
      transform: scale(1.1);
    }

    .expand-icon {
      transition: transform 0.3s ease;
    }

    .playlist-card.expanded .expand-icon {
      transform: rotate(180deg);
    }

    /* Video grid styling */
    .video-grid {
      padding: 0 16px 16px;
      transition: all 0.3s ease;
    }

    .playlist-card.expanded .video-grid {
      display: block !important;
    }

    .video-tile {
      display: flex;
      flex-direction: row;
      padding: 8px 12px;
      border-radius: 8px;
      margin-bottom: 4px;
      transition: background 0.2s ease;
      cursor: pointer;
      align-items: center;
    }

    .video-tile:hover {
      background: rgba(255,255,255,0.05);
    }

    .video-thumbnail {
      width: 60px;
      height: 45px;
      border-radius: 6px;
      margin-right: 12px;
      object-fit: cover;
    }

    .video-info {
      flex: 1;
    }

    .video-title {
      font-size: 14px;
      margin-bottom: 4px;
      color: #fff;
      line-height: 1.3;
    }

    .video-duration {
      font-size: 12px;
      color: var(--muted);
    }

    .play-button {
      opacity: 0;
      transition: opacity 0.2s ease;
      background: rgba(106,208,255,0.2);
      border: 1px solid rgba(106,208,255,0.4);
      color: #6ad0ff;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 10px;
    }

    .video-tile:hover .play-button {
      opacity: 1;
    }

    .play-button:hover {
      background: rgba(106,208,255,0.3);
      transform: scale(1.1);
    }

    /* Close button styling */
    .close-btn {
      background: rgba(255,59,48,0.2);
      border: 1px solid rgba(255,59,48,0.4);
      color: #ff3b30;
    }

    .close-btn:hover {
      background: rgba(255,59,48,0.3);
      transform: scale(1.1);
    }

    /* Enhanced Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
      }
      40% {
        transform: translateY(-10px);
      }
      60% {
        transform: translateY(-5px);
      }
    }

    @keyframes shimmer {
      0% {
        background-position: -200px 0;
      }
      100% {
        background-position: 200px 0;
      }
    }

    @keyframes glow {
      0%, 100% {
        box-shadow: 0 0 20px rgba(106,208,255,0.3);
      }
      50% {
        box-shadow: 0 0 30px rgba(106,208,255,0.6);
      }
    }

    /* Apply animations to components */
    .container {
      animation: fadeInUp 0.8s ease-out;
    }

    .card {
      animation: scaleIn 0.6s ease-out;
      animation-delay: 0.2s;
      animation-fill-mode: both;
    }

    .card:nth-child(2) {
      animation-delay: 0.4s;
    }

    .card:nth-child(3) {
      animation-delay: 0.6s;
    }

    .tabbar {
      animation: slideInUp 0.6s ease-out;
      animation-delay: 0.8s;
      animation-fill-mode: both;
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .tile {
      animation: slideInLeft 0.4s ease-out;
      animation-fill-mode: both;
    }

    .tile:nth-child(1) { animation-delay: 0.1s; }
    .tile:nth-child(2) { animation-delay: 0.2s; }
    .tile:nth-child(3) { animation-delay: 0.3s; }
    .tile:nth-child(4) { animation-delay: 0.4s; }

    .playlist-card {
      animation: slideInRight 0.5s ease-out;
      animation-fill-mode: both;
    }

    .playlist-card:nth-child(1) { animation-delay: 0.1s; }
    .playlist-card:nth-child(2) { animation-delay: 0.2s; }
    .playlist-card:nth-child(3) { animation-delay: 0.3s; }

    .music-player {
      animation: slideInUp 0.5s ease-out;
    }

    /* Enhanced hover effects */
    .btn {
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .btn:hover::before {
      left: 100%;
    }

    .control-btn:hover {
      animation: pulse 0.6s ease-in-out;
    }

    .expand-btn:active {
      animation: bounce 0.6s ease-in-out;
    }

    /* Loading shimmer effect */
    .loading {
      background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
      background-size: 200px 100%;
      animation: shimmer 1.5s infinite;
    }

    /* Success/Error message animations */
    .error-message, .success-message {
      animation: slideInRight 0.4s ease-out;
    }

    /* Playlist expansion animation improvements */
    .video-grid {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
      opacity: 0;
    }

    .playlist-card.expanded .video-grid {
      max-height: 500px;
      opacity: 1;
    }

    .video-tile {
      transform: translateX(-20px);
      opacity: 0;
      animation: slideInLeft 0.3s ease-out forwards;
    }

    .playlist-card.expanded .video-tile:nth-child(1) { animation-delay: 0.1s; }
    .playlist-card.expanded .video-tile:nth-child(2) { animation-delay: 0.15s; }
    .playlist-card.expanded .video-tile:nth-child(3) { animation-delay: 0.2s; }
    .playlist-card.expanded .video-tile:nth-child(4) { animation-delay: 0.25s; }
    .playlist-card.expanded .video-tile:nth-child(5) { animation-delay: 0.3s; }

    /* Enhanced interface improvements */
    .search input {
      background: linear-gradient(145deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      border: 1x solid rgba(106,208,255,0.2);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .search input:focus {
      background: linear-gradient(145deg, rgba(255,255,255,0.12), rgba(255,255,255,0.08));
      border-color: rgba(106,208,255,0.6);
      transform: translateY(-4px);
      animation: glow 0.5s ease-out;
    }

    /* Enhanced tab styling */
    .tab {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .tab.active::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, var(--accent), #33c3ff);
      border-radius: 2px;
      animation: slideInRight 0.3s ease-out;
    }

    /* Enhanced playlist card styling */
    .playlist-card {
      background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 20px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
      position: relative;
    }

    .playlist-card:hover {
      background: linear-gradient(145deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 15px 40px rgba(0,0,0,0.2);
      border-color: rgba(106,208,255,0.3);
    }

    .playlist-thumbnail {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 16px 16px 0 0;
      background: linear-gradient(45deg, #6c5ce7, #a29bfe, #74b9ff);
    }

    .playlist-info {
      padding: 16px;
    }

    .playlist-title {
      font-size: 16px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 8px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.3;
    }

    .playlist-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .playlist-stats {
      font-size: 12px;
      color: var(--muted);
    }

    .playlist-type-badge {
      background: rgba(106,208,255,0.2);
      color: #6ad0ff;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    .playlist-type-badge.single {
      background: rgba(255,193,7,0.2);
      color: #ffc107;
    }

    .playlist-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .playlist-action-btn {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .playlist-action-btn.primary {
      background: rgba(106,208,255,0.2);
      border: 1px solid rgba(106,208,255,0.4);
      color: #6ad0ff;
    }

    .playlist-action-btn.primary:hover {
      background: rgba(106,208,255,0.3);
      transform: translateY(-1px);
    }

    .playlist-action-btn.secondary {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: #fff;
    }

    .playlist-action-btn.secondary:hover {
      background: rgba(255,255,255,0.15);
      transform: translateY(-1px);
    }

    .playlist-action-btn.danger {
      background: rgba(255,59,48,0.2);
      border: 1px solid rgba(255,59,48,0.4);
      color: #ff3b30;
    }

    .playlist-action-btn.danger:hover {
      background: rgba(255,59,48,0.3);
      transform: translateY(-1px);
    }

    .playlist-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    /* Enhanced empty state */
    .empty-playlists {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }

    .empty-playlists svg {
      width: 64px;
      height: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-playlists h3 {
      margin: 0 0 8px 0;
      color: #fff;
      font-size: 18px;
    }

    .empty-playlists p {
      margin: 0;
      font-size: 14px;
      line-height: 1.5;
    }

    /* Enhanced quick link tiles */
    .tile {
      background: linear-gradient(145deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .tile:hover {
      background: linear-gradient(145deg, rgba(255,255,255,0.12), rgba(255,255,255,0.08));
      transform: translateY(-8px) rotateX(5deg) rotateY(-5deg) scale(1.05);
      box-shadow: 0 20px 40px rgba(106,208,255,0.3);
      border-color: rgba(106,208,255,0.4);
    }

    /* Success/Error messages with enhanced styling */
    .error-message {
      background: rgba(255,59,48,0.1);
      border: 1px solid rgba(255,59,48,0.3);
      color: #ff3b30;
      padding: 12px 16px;
      border-radius: 12px;
      margin: 12px 0;
      backdrop-filter: blur(10px);
      animation: slideInRight 0.4s ease-out;
    }

    .success-message {
      background: rgba(46,213,115,0.1);
      border: 1px solid rgba(46,213,115,0.3);
      color: #2ed573;
      padding: 12px 16px;
      border-radius: 12px;
      margin: 12px 0;
      backdrop-filter: blur(10px);
      animation: slideInRight 0.4s ease-out;
    }



    .playlist-card {
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 16px;
      transition: transform .25s ease, box-shadow .3s ease;
      will-change: transform;
      cursor: pointer;
      position: relative;
    }

    .playlist-card:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 16px 32px rgba(106,208,255,.3);
    }

    .playlist-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .playlist-thumbnail {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      object-fit: cover;
      background: rgba(255,255,255,0.1);
    }

    .playlist-info h4 {
      margin: 0;
      font-size: 16px;
      font-weight: 700;
      color: #fff;
      line-height: 1.3;
    }

    .playlist-info p {
      margin: 4px 0 0 0;
      font-size: 12px;
      color: var(--muted);
    }

    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .video-tile {
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      padding: 12px;
      transition: transform .2s ease, box-shadow .25s ease;
      cursor: pointer;
      position: relative;
    }

    .video-tile:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 8px 20px rgba(106,208,255,.2);
    }

    .video-thumbnail {
      width: 100%;
      height: 100px;
      border-radius: 8px;
      object-fit: cover;
      background: rgba(255,255,255,0.1);
      margin-bottom: 8px;
    }

    .video-title {
      font-size: 13px;
      font-weight: 600;
      color: #fff;
      line-height: 1.3;
      margin-bottom: 4px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .video-duration {
      font-size: 11px;
      color: var(--muted);
    }

    .play-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.7);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      opacity: 0;
      transition: opacity .2s ease;
    }

    .video-tile:hover .play-button {
      opacity: 1;
    }

    .play-button:hover {
      background: rgba(106,208,255,0.8);
    }

    .playing .play-button {
      opacity: 1;
      background: rgba(106,208,255,0.9);
    }

    /* Enhanced Music Player Bar */
    .music-player {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 350px;
      background: rgba(10,10,15,0.98);
      border-radius: 24px;
      padding: 16px 24px;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.15);
      box-shadow: 0 16px 48px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.05);
      display: none;
      align-items: center;
      gap: 20px;
      z-index: 5;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .music-player.active {
      display: flex;
      animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes slideUp {
      from {
        transform: translateX(100px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .current-track {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 16px;
      min-width: 0;
      max-width: 400px;
    }

    .current-thumbnail {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      object-fit: cover;
      background: linear-gradient(135deg, rgba(106,208,255,0.3), rgba(55,66,250,0.3));
      border: 2px solid rgba(255,255,255,0.1);
      flex-shrink: 0;
    }

    .current-info {
      min-width: 0;
      flex: 1;
    }

    .current-info h4 {
      margin: 0 0 4px 0;
      font-size: 15px;
      font-weight: 700;
      color: #fff;
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    .current-info p {
      margin: 0;
      font-size: 13px;
      color: var(--muted);
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    .player-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
    }

    .control-btn {
      background: rgba(255,255,255,0.08);
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .control-btn:hover {
      background: rgba(106,208,255,0.2);
      transform: scale(1.05);
      border-color: rgba(106,208,255,0.3);
    }

    .control-btn.primary {
      background: linear-gradient(135deg, var(--accent), #33c3ff);
      color: #05202a;
      width: 52px;
      height: 52px;
      border: 2px solid rgba(255,255,255,0.2);
      box-shadow: 0 8px 24px rgba(106,208,255,0.3);
    }

    .control-btn.primary:hover {
      background: linear-gradient(135deg, #33c3ff, var(--accent));
      transform: scale(1.05);
      box-shadow: 0 12px 32px rgba(106,208,255,0.4);
    }

    .control-btn:active {
      transform: scale(0.95);
    }

    /* Tab content visibility */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Tabbar */
    .tabbar-wrap {
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:10px;
      border-radius:44px;
      z-index:6;
      padding:2px;
      background: linear-gradient(135deg, #00f0ff, #9b6bff, #ff4fd8, #00f0ff);
      background-size: 300% 300%;
      animation: gradientShift 8s ease infinite;
      will-change: background-position;
    }
    
    .tabbar {
      height:var(--tab-height);
      width:min(600px,calc(100% - 40px));
      background:rgba(10,10,15,.98);
      border-radius:40px;
      display:flex;
      align-items:center;
      justify-content:space-around;
      padding:8px 18px;
      border:1px solid rgba(255,255,255,.1);
      box-shadow:0 16px 48px rgba(0,0,0,.6), 0 0 0 1px rgba(255,255,255,.05);
      backdrop-filter: blur(20px);
    }
    
    .tab{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:2px;
      color:rgba(255,255,255,0.6);
      font-size:12px;
      font-weight: 600;
      cursor:pointer;
      padding:10px 15px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      will-change: transform;
      border-radius: 16px;
      position: relative;
      min-width: 8px;
    }
    
    .tab:hover{
      transform:translateY(-6px) scale(1.08);
      color:#fff;
    }
    
    .tab:active{
      transform:scale(0.92);
    }
    
    .tab.active{
      color:#061e25;
      background:linear-gradient(180deg,#9ff2ff,#55d3ff);
      transform:translateY(-8px) scale(1.1);
      border-radius: 12px;
    }

    /* Hidden YouTube player */
    #youtube-player {
      position: absolute;
      top: -9999px;
      left: -9999px;
      width: 1px;
      height: 1px;
      opacity: 0;
    }

    /* Error states */
    .error-message {
      background: rgba(255,59,48,0.1);
      border: 1px solid rgba(255,59,48,0.3);
      border-radius: 12px;
      padding: 12px 16px;
      color: #ff6b6b;
      font-size: 14px;
      margin-top: 12px;
    }

    /* Loading states */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: var(--muted);
      background: rgba(255,255,255,0.02);
      border-radius: 16px;
      margin: 16px 0;
      border: 1px solid rgba(255,255,255,0.05);
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid rgba(255,255,255,0.1);
      border-top: 3px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 12px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Delete button for playlists */
    .delete-btn {
      background: rgba(255,59,48,0.8);
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      position: absolute;
      top: 8px;
      right: 8px;
      transition: all 0.2s ease;
    }

    .delete-btn:hover {
      background: rgba(255,59,48,1);
      transform: scale(1.1);
    }

    .playlist-card:hover .delete-btn {
      display: flex;
    }

    /* Show more button */
    .show-more-btn {
      margin-top: 12px;
      padding: 12px 16px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      color: var(--accent);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .show-more-btn:hover {
      background: rgba(106,208,255,0.1);
      border-color: rgba(106,208,255,0.3);
      transform: translateY(-2px);
    }

    /* Playlist modal styles */
    .playlist-modal {
      width: min(600px, 90vw);
      max-height: 80vh;
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .modal-header h3 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      color: #fff;
    }

    .close-btn {
      background: rgba(255,255,255,0.1);
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .close-btn:hover {
      background: rgba(255,59,48,0.8);
      transform: scale(1.1);
    }

    .playlist-songs-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      max-height: 60vh;
    }

    .song-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 16px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 8px;
    }

    .song-item:hover {
      background: rgba(255,255,255,0.05);
      transform: translateX(4px);
    }

    .song-thumbnail {
      width: 48px;
      height: 48px;
      border-radius: 8px;
      object-fit: cover;
      background: rgba(255,255,255,0.1);
      flex-shrink: 0;
    }

    .song-info {
      flex: 1;
      min-width: 0;
    }

    .song-info h4 {
      margin: 0 0 4px 0;
      font-size: 14px;
      font-weight: 600;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .song-info p {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .song-play-btn {
      background: rgba(106,208,255,0.2);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      color: var(--accent);
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .song-play-btn:hover {
      background: rgba(106,208,255,0.4);
      transform: scale(1.1);
    }

    /* Modal styles for playlist view */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 24px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      transform: scale(0.9) translateY(20px);
      transition: all 0.3s ease;
    }

    .modal-overlay.show .modal {
      transform: scale(1) translateY(0);
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
      .container {
        margin: 16px auto;
        padding: 16px;
      }
      
      .tiles {
        justify-content: center;
      }
      
      .tile {
        min-width: 140px;
      }
      
      .engines {
        justify-content: center;
      }
      
      .playlist-grid {
        grid-template-columns: 1fr;
      }
      
      .modal {
        width: 95%;
        max-height: 90vh;
      }
      
      .engine {
        min-width: 100px;
      }

      .playlist-grid {
        grid-template-columns: 1fr;
      }

      .video-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }

      .music-player {
        width: calc(100% - 20px);
        padding: 10px 16px;
      }

      .current-info h4 {
        font-size: 13px;
      }

      .current-info p {
        font-size: 11px;
      }
    }

    @media (max-width: 480px) {
      .search-bar {
        flex-direction: column;
        gap: 12px;
      }
      
      .btn {
        margin-left: 0;
        width: 100%;
      }

      .tabbar {
        width: calc(100% - 20px);
        padding: 8px 12px;
      }

      .tab {
        font-size: 11px;
        padding: 6px 8px;
      }

      .tiles {
        grid-template-columns: repeat(2, 1fr);
      }

      .playlist-grid {
        max-height: 50vh;
      }
    }
  </style>
</head>
<body>
<canvas id="bg"></canvas>

<!-- Hidden YouTube Player -->
<div id="youtube-player"></div>

<div class="container">
  <!-- Search Tab Content -->
  <div id="search-content" class="tab-content active">
    <div class="card">
      <h2>Search the web</h2>

      <!-- Search -->
      <div class="search-bar">
        <form id="searchForm" class="search">
          <input name="q" id="searchInput" type="search" placeholder="Search..." autocomplete="off">
        </form>
        <button id="searchBtn" class="btn" type="button">Go</button>
      </div>

      <!-- Engine Selector -->
      <div class="engines">
        <div class="engine active" data-engine="bing" role="button" tabindex="0">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#008373" d="M2 3l7 3v8l5 3 5-3V3H2z"/></svg>Bing
        </div>
        <div class="engine" data-engine="google" role="button" tabindex="0">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#4285F4" d="M21.35 11.1h-9.17v2.92h5.42c-.24 1.47-1.63 4.31-5.42 4.31-3.26 0-5.92-2.7-5.92-6.04 0-3.34 2.66-6.04 5.92-6.04 1.86 0 3.1.79 3.82 1.48l2.61-2.52C17.55 3.42 15.05 2.2 12.18 2.2 7.08 2.2 3 6.28 3 11.38c0 5.1 4.08 9.18 9.18 9.18 5.3 0 8.82-3.73 8.82-9.04 0-.6-.07-1.04-.16-1.42z"/></svg>Google
        </div>
        <div class="engine" data-engine="chatgpt" role="button" tabindex="0">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#10a37f" d="M12 2a10 10 0 100 20 10 10 0 000-20z"/></svg>ChatGPT
        </div>
        <div class="engine" data-engine="copilot" role="button" tabindex="0">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#0078d4" d="M12 2a10 10 0 100 20 10 10 0 000-20z"/></svg>Copilot
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Quick Links</h2>
      <div class="tiles" id="linkTiles">
        <!-- Default quick links will be loaded here -->
        <div class="add-tile" onclick="showAddLinkModal()">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 4c4.41 0 8 3.59 8 8s-3.59 8-8 8-8-3.59-8-8 3.59-8 8-8m0-2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 9h-4V7h-2v4H7v2h4v4h2v-4h4v-2z"/></svg>
          Add Quick Link
        </div>
      </div>
    </div>
  </div>

  <!-- Playlists Tab Content -->
  <div id="playlists-content" class="tab-content">
    <div class="card">
      <h2>YouTube Playlists</h2>
      
      <!-- Playlist Search -->
      <div class="playlist-search">
        <div class="search-bar">
          <form id="playlistForm" class="search">
            <input name="playlist" id="playlistInput" type="text" placeholder="Enter YouTube playlist URL/ID or single video URL..." autocomplete="off">
          </form>
          <button id="playlistBtn" class="btn" type="button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
              <path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>
            </svg>
            Add Playlist
          </button>
          <button id="addSingleBtn" class="btn secondary" type="button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
            </svg>
            Add Single Song
          </button>
        </div>


      </div>

      <!-- User playlists -->
      <div class="playlist-container">
        <div id="playlistsGrid" class="playlist-grid">
          <!-- Playlists will be loaded here -->
        </div>
        <div class="scroll-indicator">↕ Scroll to see more</div>
      </div>
    </div>
  </div>
</div>

<!-- Music Player Bar -->
<div id="musicPlayer" class="music-player">
  <div class="current-track">
    <div class="current-thumbnail" id="currentThumbnail" style="background: linear-gradient(45deg, #6c5ce7, #a29bfe);"></div>
    <div class="current-info">
      <h4 id="currentTitle">No track selected</h4>
      <p id="currentChannel">Select a video to play</p>
    </div>
  </div>
  <div class="player-controls">
    <button id="prevBtn" class="control-btn" title="Previous track">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>
      </svg>
    </button>
    <button id="playPauseBtn" class="control-btn primary" title="Play/Pause">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M8 5v14l11-7z"/>
      </svg>
    </button>
    <button id="nextBtn" class="control-btn" title="Next track">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M6 18V6h2v12H6zM9.5 12l8.5 6V6l-8.5 6z"/>
      </svg>
    </button>
    <button id="replayBtn" class="control-btn" title="Replay current track">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>
      </svg>
    </button>
    <button id="closePlayerBtn" class="control-btn close-btn" onclick="closePlayer()" title="Close player">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
      </svg>
    </button>
  </div>
</div>

<!-- Tab Bar -->
<div class="tabbar-wrap">
  <div class="tabbar">
    <div class="tab active" data-tab="search">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
      </svg>
      Search
    </div>
    <div class="tab" data-tab="playlists">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
        <path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>
      </svg>
      Playlists
    </div>
  </div>
</div>

<!-- Add Link Modal -->
<div id="addLinkModal" class="modal-overlay">
  <div class="modal">
    <h3>Add Quick Link</h3>
    <form class="modal-form" id="addLinkForm">
      <div class="form-group">
        <label for="linkName">Name</label>
        <input type="text" id="linkName" required>
      </div>
      <div class="form-group">
        <label for="linkUrl">URL</label>
        <input type="url" id="linkUrl" required>
      </div>
      <div class="form-group">
        <label for="linkDesc">Description (optional)</label>
        <input type="text" id="linkDesc">
      </div>
      <div class="modal-buttons">
        <button type="button" class="modal-btn secondary" onclick="hideAddLinkModal()">Cancel</button>
        <button type="submit" class="modal-btn primary">Add Link</button>
      </div>
    </form>
  </div>
</div>

<script>
// YouTube player variables
let youtubePlayer;
let currentVideoId = null;
let isPlayerReady = false;
let isPlaying = false;
let currentPlaylist = [];
let currentTrackIndex = 0;
let isPlayerVisible = false;

// Global error handler for unhandled promise rejections
window.addEventListener('unhandledrejection', event => {
  console.error('Unhandled promise rejection:', event.reason);
  event.preventDefault(); // Prevent the default browser behavior
});

// Initialize YouTube iframe API
function onYouTubeIframeAPIReady() {
  youtubePlayer = new YT.Player('youtube-player', {
    height: '1',
    width: '1',
    playerVars: {
      'autoplay': 0,
      'controls': 0,
      'disablekb': 1,
      'enablejsapi': 1,
      'fs': 0,
      'iv_load_policy': 3,
      'modestbranding': 1,
      'playsinline': 1,
      'rel': 0
    },
    events: {
      'onReady': onPlayerReady,
      'onStateChange': onPlayerStateChange
    }
  });
}

function onPlayerReady(event) {
  isPlayerReady = true;
  console.log('YouTube player ready');
}

function onPlayerStateChange(event) {
  const playPauseBtn = document.getElementById('playPauseBtn');
  const playIcon = '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>';
  const pauseIcon = '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';

  if (event.data === YT.PlayerState.PLAYING) {
    playPauseBtn.innerHTML = pauseIcon;
    isPlaying = true;
  } else if (event.data === YT.PlayerState.PAUSED) {
    playPauseBtn.innerHTML = playIcon;
    isPlaying = false;
  } else if (event.data === YT.PlayerState.ENDED) {
    playPauseBtn.innerHTML = playIcon;
    isPlaying = false;
    // Auto-play next track when current track ends
    setTimeout(() => playNext(), 1000);
  }
}

// Load YouTube iframe API
function loadYouTubeAPI() {
  const tag = document.createElement('script');
  tag.src = 'https://www.youtube.com/iframe_api';
  const firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
}

// Play video function
function playVideo(videoId, title, channel = 'Unknown Artist', playlistVideos = null) {
  if (!isPlayerReady) {
    console.log('Player not ready yet');
    return;
  }

  currentVideoId = videoId;
  
  // If playlist videos are provided, set up the current playlist
  if (playlistVideos && Array.isArray(playlistVideos)) {
    currentPlaylist = playlistVideos;
    currentTrackIndex = currentPlaylist.findIndex(video => video.id === videoId);
    if (currentTrackIndex === -1) currentTrackIndex = 0;
  }
  
  youtubePlayer.loadVideoById(videoId);
  
  // Show music player
  const musicPlayer = document.getElementById('musicPlayer');
  musicPlayer.style.display = 'flex';
  isPlayerVisible = true;
  
  // Update player UI
  document.getElementById('currentTitle').textContent = title;
  document.getElementById('currentChannel').textContent = channel;
  
  // Set thumbnail
  const thumbnail = document.getElementById('currentThumbnail');
  if (thumbnail) {
    thumbnail.style.backgroundImage = `url(https://img.youtube.com/vi/${videoId}/mqdefault.jpg)`;
  }
  
  // Update playing states
  updatePlayingStates();
}

// Play next track
function playNext() {
  if (currentPlaylist.length === 0) return;
  
  currentTrackIndex = (currentTrackIndex + 1) % currentPlaylist.length;
  const nextTrack = currentPlaylist[currentTrackIndex];
  
  if (nextTrack) {
    playVideo(nextTrack.id, nextTrack.title, nextTrack.channelTitle, currentPlaylist);
  }
}

// Play previous track
function playPrevious() {
  if (currentPlaylist.length === 0) return;
  
  currentTrackIndex = currentTrackIndex <= 0 ? currentPlaylist.length - 1 : currentTrackIndex - 1;
  const prevTrack = currentPlaylist[currentTrackIndex];
  
  if (prevTrack) {
    playVideo(prevTrack.id, prevTrack.title, prevTrack.channelTitle, currentPlaylist);
  }
}

// Replay current track
function replayTrack() {
  if (!isPlayerReady || !currentVideoId) return;
  youtubePlayer.seekTo(0);
  youtubePlayer.playVideo();
}

function updatePlayingStates() {
  document.querySelectorAll('.video-tile').forEach(tile => {
    tile.classList.remove('playing');
  });
  
  if (currentVideoId) {
    const playingTile = document.querySelector(`[onclick*="${currentVideoId}"]`);
    if (playingTile) {
      playingTile.classList.add('playing');
    }
  }
}

// Player controls
document.addEventListener('DOMContentLoaded', function() {
  const playPauseBtn = document.getElementById('playPauseBtn');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  playPauseBtn.addEventListener('click', () => {
    if (!isPlayerReady || !currentVideoId) return;
    
    if (isPlaying) {
      youtubePlayer.pauseVideo();
    } else {
      youtubePlayer.playVideo();
    }
  });

  prevBtn.addEventListener('click', () => {
    playPrevious();
  });

  nextBtn.addEventListener('click', () => {
    playNext();
  });

  const replayBtn = document.getElementById('replayBtn');
  replayBtn.addEventListener('click', () => {
    replayTrack();
  });

  // Tab switching functionality
  const tabs = document.querySelectorAll('.tab');
  const tabContents = document.querySelectorAll('.tab-content');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const targetTab = tab.dataset.tab;
      
      // Remove active class from all tabs and contents
      tabs.forEach(t => t.classList.remove('active'));
      tabContents.forEach(content => content.classList.remove('active'));
      
      // Add active class to clicked tab and corresponding content
      tab.classList.add('active');
      document.getElementById(`${targetTab}-content`).classList.add('active');
    });
  });

  // Load existing data
  loadQuickLinks();
  loadUserPlaylists();
  
  // Initialize search functionality
  initializeSearch();
  initializePlaylistSearch();
  
  // Initialize background animation
  initBackgroundAnimation();
});

// Load sample playlist
function loadSamplePlaylist() {
  // Already loaded in HTML, just for demo
}

// Playlist functionality
function initializePlaylistSearch() {
  const playlistForm = document.getElementById('playlistForm');
  const playlistBtn = document.getElementById('playlistBtn');
  const playlistInput = document.getElementById('playlistInput');

  function addPlaylist() {
    const input = playlistInput.value.trim();
    if (!input) return;

    // Check if it's a YouTube playlist URL
    const playlistId = extractPlaylistId(input);
    if (playlistId) {
      fetchPlaylistData(playlistId);
    } else {
      // Treat as playlist ID directly
      if (input.length > 10) {
        fetchPlaylistData(input);
      } else {
        showError('Please enter a valid YouTube playlist URL or ID');
      }
    }
  }

  playlistForm.addEventListener('submit', (e) => {
    e.preventDefault();
    addPlaylist();
  });

  playlistBtn.addEventListener('click', addPlaylist);
  
  // Add single song functionality
  const addSingleBtn = document.getElementById('addSingleBtn');
  if (addSingleBtn) {
    addSingleBtn.addEventListener('click', addSingleSong);
  }
}

function extractPlaylistId(url) {
  // Handle various YouTube playlist URL formats
  const patterns = [
    /[&?]list=([a-zA-Z0-9_-]+)/,
    /playlist\?list=([a-zA-Z0-9_-]+)/,
    /^([a-zA-Z0-9_-]+)$/
  ];
  
  for (const pattern of patterns) {
    const match = url.match(pattern);
    if (match) return match[1];
  }
  return null;
}

function extractVideoId(url) {
  // Handle various YouTube video URL formats
  const patterns = [
    /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,
    /^([a-zA-Z0-9_-]{11})$/
  ];
  
  for (const pattern of patterns) {
    const match = url.match(pattern);
    if (match) return match[1];
  }
  return null;
}

async function addSingleSong() {
  const input = document.getElementById('playlistInput').value.trim();
  if (!input) return;

  // Check if it's a YouTube video URL
  const videoId = extractVideoId(input);
  if (videoId) {
    await fetchSingleVideoData(videoId);
  } else {
    showError('Please enter a valid YouTube video URL or ID');
  }
}

async function fetchSingleVideoData(videoId) {
  try {
    showLoading('Adding single song...');
    
    const API_KEY = 'AIzaSyCeWhGZfLzjWrhQ8-nWp5exmyO7sZXdE1g';
    
    // Fetch video info
    const videoResponse = await fetch(
      `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${API_KEY}`
    ).catch(err => {
      throw new Error('Network error: Please check your internet connection.');
    });

    if (!videoResponse.ok) {
      if (videoResponse.status === 403) {
        throw new Error('API quota exceeded. Please try again later.');
      }
      throw new Error(`API error: ${videoResponse.status}`);
    }

    const videoData = await videoResponse.json();
    
    if (!videoData.items || videoData.items.length === 0) {
      throw new Error('Video not found. Please check the URL or video ID.');
    }

    const video = videoData.items[0];
    
    // Create a single-song "playlist"
    const singleSongPlaylist = {
      id: `single_${videoId}_${Date.now()}`,
      title: `Single: ${video.snippet.title}`,
      channelTitle: video.snippet.channelTitle,
      thumbnail: video.snippet.thumbnails?.medium?.url || video.snippet.thumbnails?.default?.url || '',
      videos: [{
        id: videoId,
        title: video.snippet.title,
        channelTitle: video.snippet.channelTitle,
        thumbnail: video.snippet.thumbnails?.medium?.url || video.snippet.thumbnails?.default?.url || ''
      }]
    };

    // Check for duplicates and save to localStorage
    const savedPlaylists = JSON.parse(localStorage.getItem('userPlaylists') || '[]');
    
    // Check if this single song already exists
    const existingSingle = savedPlaylists.find(p => 
      p.id && p.id.includes(`single_${videoId}`)
    );
    
    if (existingSingle) {
      hideLoading();
      showError('This song is already in your collection');
      return;
    }
    
    savedPlaylists.push(singleSongPlaylist);
    localStorage.setItem('userPlaylists', JSON.stringify(savedPlaylists));
    
    hideLoading();
    loadUserPlaylists();
    document.getElementById('playlistInput').value = '';
    showSuccess(`Added single song: ${video.snippet.title}`);
    
  } catch (error) {
    hideLoading();
    console.error('Error fetching video:', error);
    showError(error.message);
  }
}

async function fetchPlaylistData(playlistId) {
  try {
    showLoading();
    
    // First try to create a demo playlist for demonstration
    if (playlistId === 'demo' || playlistId === 'test') {
      const demoPlaylist = createDemoPlaylist();
      const savedPlaylists = JSON.parse(localStorage.getItem('userPlaylists') || '[]');
      savedPlaylists.push(demoPlaylist);
      localStorage.setItem('userPlaylists', JSON.stringify(savedPlaylists));
      
      hideLoading();
      loadUserPlaylists();
      document.getElementById('playlistInput').value = '';
      showSuccess(`Added demo playlist: ${demoPlaylist.title}`);
      return;
    }
    
    // Use YouTube Data API v3 with the provided API key
    const API_KEY = 'AIzaSyCeWhGZfLzjWrhQ8-nWp5exmyO7sZXdE1g';
    
    // Fetch playlist info
    const playlistResponse = await fetch(
      `https://www.googleapis.com/youtube/v3/playlists?part=snippet&id=${playlistId}&key=${API_KEY}`
    ).catch(err => {
      throw new Error('Network error: Please check your internet connection.');
    });
    
    if (!playlistResponse.ok) {
      if (playlistResponse.status === 403) {
        throw new Error('API quota exceeded. Please try again later.');
      } else if (playlistResponse.status === 404) {
        throw new Error('Playlist not found. Please check the ID or URL.');
      } else {
        throw new Error(`API error: ${playlistResponse.status}. Please try again.`);
      }
    }
    
    const playlistData = await playlistResponse.json().catch(err => {
      throw new Error('Invalid response from YouTube API.');
    });
    
    if (!playlistData.items || playlistData.items.length === 0) {
      throw new Error('Playlist not found. Make sure the playlist is public.');
    }
    
    const playlist = playlistData.items[0];
    
    // Fetch playlist videos
    const videosResponse = await fetch(
      `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${playlistId}&maxResults=50&key=${API_KEY}`
    ).catch(err => {
      throw new Error('Network error while fetching videos.');
    });
    
    if (!videosResponse.ok) {
      throw new Error('Failed to fetch playlist videos. Please try again.');
    }
    
    const videosData = await videosResponse.json().catch(err => {
      throw new Error('Invalid video data from YouTube API.');
    });
    
    if (!videosData.items || videosData.items.length === 0) {
      throw new Error('No videos found in this playlist.');
    }
    
    const playlistObj = {
      id: playlistId,
      title: playlist.snippet.title || 'Untitled Playlist',
      description: playlist.snippet.description || '',
      thumbnail: playlist.snippet.thumbnails?.medium?.url || playlist.snippet.thumbnails?.default?.url || '',
      channelTitle: playlist.snippet.channelTitle || 'Unknown Channel',
      videos: videosData.items.map(item => ({
        id: item.snippet?.resourceId?.videoId || '',
        title: item.snippet?.title || 'Untitled Video',
        thumbnail: item.snippet?.thumbnails?.medium?.url || item.snippet?.thumbnails?.default?.url || '',
        channelTitle: item.snippet?.channelTitle || 'Unknown Channel',
        description: item.snippet?.description || ''
      })).filter(video => video.id && video.title !== 'Deleted video' && video.title !== 'Private video')
    };
    
    if (playlistObj.videos.length === 0) {
      throw new Error('This playlist contains no playable videos.');
    }
    
    // Save playlist to localStorage
    const savedPlaylists = JSON.parse(localStorage.getItem('userPlaylists') || '[]');
    savedPlaylists.push(playlistObj);
    localStorage.setItem('userPlaylists', JSON.stringify(savedPlaylists));
    
    hideLoading();
    loadUserPlaylists();
    document.getElementById('playlistInput').value = '';
    showSuccess(`Added playlist: ${playlistObj.title} (${playlistObj.videos.length} videos)`);
    
  } catch (error) {
    hideLoading();
    console.error('Playlist fetch error:', error);
    showError(error.message || 'An unexpected error occurred. Please try again.');
  }
}

function createDemoPlaylist() {
  return {
    id: 'demo_' + Date.now(),
    title: 'Demo Music Collection',
    description: 'A collection of demo tracks for testing',
    thumbnail: '',
    channelTitle: 'Demo Channel',
    videos: [
      {
        id: 'dQw4w9WgXcQ',
        title: 'Rick Astley - Never Gonna Give You Up',
        thumbnail: '',
        channelTitle: 'RickAstleyVEVO',
        description: 'Classic hit'
      },
      {
        id: 'jNQXAC9IVRw',
        title: 'Me at the zoo',
        thumbnail: '',
        channelTitle: 'jawed',
        description: 'First YouTube video'
      },
      {
        id: '9bZkp7q19f0',
        title: 'PSY - GANGNAM STYLE',
        thumbnail: '',
        channelTitle: 'officialpsy',
        description: 'Gangnam Style'
      }
    ]
  };
}

function showApiKeyMessage() {
  const playlistsGrid = document.getElementById('playlistsGrid');
  const messageDiv = document.createElement('div');
  messageDiv.className = 'error-message';
  messageDiv.style.background = 'rgba(255, 193, 7, 0.1)';
  messageDiv.style.borderColor = 'rgba(255, 193, 7, 0.3)';
  messageDiv.style.color = '#ffc107';
  messageDiv.innerHTML = `
    <strong>YouTube API Setup Required</strong><br>
    To add real YouTube playlists, you need a YouTube Data API key.<br>
    <br>
    <strong>For now, try these options:</strong><br>
    • Type "demo" to add a sample playlist<br>
    • Get a YouTube API key at: <a href="https://console.developers.google.com/" target="_blank" style="color: #6ad0ff;">Google Developers Console</a><br>
    • Enable YouTube Data API v3 and add your key to the code
  `;
  playlistsGrid.appendChild(messageDiv);
  
  setTimeout(() => {
    messageDiv.remove();
  }, 8000);
}

function loadUserPlaylists() {
  const playlistsGrid = document.getElementById('playlistsGrid');
  const savedPlaylists = JSON.parse(localStorage.getItem('userPlaylists') || '[]');
  
  if (savedPlaylists.length === 0) {
    playlistsGrid.innerHTML = `
      <div class="empty-playlists">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>
        </svg>
        <h3>No Music Yet</h3>
        <p>Start building your collection by adding playlists or searching for songs above.</p>
      </div>
    `;
    return;
  }
  
  playlistsGrid.innerHTML = savedPlaylists.map((playlist, index) => {
    const isPlaylist = !playlist.isSingle && playlist.videos && playlist.videos.length > 1;
    const isSingle = playlist.isSingle || (playlist.videos && playlist.videos.length === 1);
    const videoCount = playlist.videos ? playlist.videos.length : 0;
    const firstVideo = playlist.videos && playlist.videos.length > 0 ? playlist.videos[0] : null;
    const thumbnail = playlist.thumbnail || (firstVideo ? (firstVideo.thumbnail || (firstVideo.thumbnails && firstVideo.thumbnails.medium ? firstVideo.thumbnails.medium.url : '')) : '');
    
    return `
      <div class="playlist-card">
        <img src="${thumbnail}" 
             alt="${playlist.title}" 
             class="playlist-thumbnail"
             onerror="this.style.background='linear-gradient(45deg, #6c5ce7, #a29bfe, #74b9ff)'; this.style.display='block';">
        
        <div class="playlist-info">
          <div class="playlist-title">${playlist.title || 'Untitled Playlist'}</div>
          
          <div class="playlist-meta">
            <div class="playlist-stats">
              ${videoCount} ${videoCount === 1 ? 'song' : 'songs'}
              ${playlist.channelTitle ? ` • ${playlist.channelTitle}` : ''}
            </div>
            <div class="playlist-type-badge ${isSingle ? 'single' : ''}">
              ${isSingle ? 'Single' : 'Playlist'}
            </div>
          </div>
          
          <div class="playlist-actions">
            <button class="playlist-action-btn primary" onclick="playUserPlaylist(${index})" title="Play all songs">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5v14l11-7z"/>
              </svg>
              Play
            </button>
            
            <button class="playlist-action-btn secondary" onclick="togglePlaylistView(${index})" title="View songs">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
              </svg>
              View
            </button>
            
            <button class="playlist-action-btn danger" onclick="deletePlaylist(${index})" title="Delete playlist">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    `;
  }).join('');
}

function createPlaylistCard(playlist) {
  const card = document.createElement('div');
  card.className = 'playlist-card user-playlist';
  
  // Safely escape strings for HTML
  const escapeHtml = (text) => {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  };
  
  const safeThumbnail = playlist.thumbnail || '';
  const safeTitle = escapeHtml(playlist.title || 'Untitled Playlist');
  const safeChannelTitle = escapeHtml(playlist.channelTitle || 'Unknown Channel');
  const videoCount = playlist.videos ? playlist.videos.length : 0;
  
  card.innerHTML = `
    <div class="playlist-header">
      <img class="playlist-thumbnail" src="${safeThumbnail}" alt="${safeTitle}" onerror="this.style.background='linear-gradient(45deg, #3742fa, #2f3542)'; this.src='';">
      <div class="playlist-info">
        <h4>${safeTitle}</h4>
        <p class="first-song-title">${playlist.videos && playlist.videos[0] ? escapeHtml(playlist.videos[0].title) : 'No songs available'}</p>
      </div>
      <div class="playlist-controls">
        <button class="play-all-btn" onclick="event.stopPropagation(); playVideoFromPlaylist('${playlist.id}', 0)" title="Play first song">▶</button>
        <button class="expand-btn" onclick="event.stopPropagation(); togglePlaylistExpansion('${playlist.id}')" title="Show all songs">
          <svg class="expand-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
          </svg>
        </button>
        <button class="delete-btn" onclick="event.stopPropagation(); deletePlaylist('${playlist.id}')" title="Delete playlist">×</button>
      </div>
    </div>
    <div class="video-grid" style="display: none;">
      ${playlist.videos ? playlist.videos.map((video, index) => {
        const safeVideoTitle = escapeHtml(video.title || 'Untitled Video');
        const safeVideoChannel = escapeHtml(video.channelTitle || 'Unknown Channel');
        const safeVideoThumbnail = video.thumbnail || '';
        return `
          <div class="video-tile" onclick="playVideoFromPlaylist('${playlist.id}', ${index})">
            <img class="video-thumbnail" src="${safeVideoThumbnail}" alt="${safeVideoTitle}" onerror="this.style.background='linear-gradient(45deg, #ff6348, #ff3838)'; this.src='';">
            <div class="video-info">
              <div class="video-title">${safeVideoTitle}</div>
              <div class="video-duration">${safeVideoChannel}</div>
            </div>
            <button class="play-button">▶</button>
          </div>
        `;
      }).join('') : ''}
    </div>
  `;
  
  return card;
}

function deletePlaylist(index) {
  const savedPlaylists = JSON.parse(localStorage.getItem('userPlaylists') || '[]');
  const playlist = savedPlaylists[index];
  
  if (!playlist) {
    showError('Playlist not found');
    return;
  }
  
  if (confirm(`Delete "${playlist.title}"?\n\nThis action cannot be undone.`)) {
    // Remove playlist from array
    savedPlaylists.splice(index, 1);
    
    // Save updated array back to localStorage
    localStorage.setItem('userPlaylists', JSON.stringify(savedPlaylists));
    
    // Refresh the display
    loadUserPlaylists();
    
    // Show success message
    const playlistsGrid = document.getElementById('playlistsGrid');
    const successDiv = document.createElement('div');
    successDiv.className = 'success-message';
    successDiv.innerHTML = `
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px; vertical-align: middle;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
      </svg>
      Playlist "${playlist.title}" deleted successfully
    `;
    
    // Insert at top of grid for visibility
    playlistsGrid.insertBefore(successDiv, playlistsGrid.firstChild);
    
    setTimeout(() => {
      successDiv.style.animation = 'slideInLeft 0.3s ease-out reverse';
      setTimeout(() => successDiv.remove(), 300);
    }, 3000);
  }
}

function togglePlaylistView(index) {
  const savedPlaylists = JSON.parse(localStorage.getItem('userPlaylists') || '[]');
  const playlist = savedPlaylists[index];
  
  if (!playlist || !playlist.videos || playlist.videos.length === 0) {
    showError('No songs in this playlist');
    return;
  }
  
  // Create modal for playlist view
  const modal = document.createElement('div');
  modal.className = 'modal-overlay';
  modal.innerHTML = `
    <div class="modal playlist-modal">
      <div class="modal-header">
        <h3>${playlist.title}</h3>
        <button class="close-btn" onclick="this.closest('.modal-overlay').remove()">×</button>
      </div>
      <div class="playlist-songs-container">
        ${playlist.videos.map((video, videoIndex) => `
          <div class="song-item" onclick="playVideoFromUserPlaylist(${index}, ${videoIndex})">
            <img src="${video.thumbnail || (video.thumbnails && video.thumbnails.medium ? video.thumbnails.medium.url : '')}" 
                 alt="${video.title}" 
                 class="song-thumbnail"
                 onerror="this.style.background='linear-gradient(45deg, #6c5ce7, #a29bfe)'; this.style.display='block';">
            <div class="song-info">
              <h4>${video.title}</h4>
              <p>${video.channelTitle || 'Unknown Artist'}</p>
            </div>
            <button class="song-play-btn" onclick="event.stopPropagation(); playVideoFromUserPlaylist(${index}, ${videoIndex})">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5v14l11-7z"/>
              </svg>
            </button>
          </div>
        `).join('')}
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
  setTimeout(() => modal.classList.add('show'), 10);
}

// Play video from specific playlist
function playVideoFromPlaylist(playlistId, videoIndex) {
  const savedPlaylists = JSON.parse(localStorage.getItem('userPlaylists') || '[]');
  const playlist = savedPlaylists.find(p => p.id === playlistId);
  
  if (playlist && playlist.videos && playlist.videos[videoIndex]) {
    const video = playlist.videos[videoIndex];
    playVideo(video.id, video.title, video.channelTitle, playlist.videos);
  }
}

// Toggle playlist expansion (dropdown style)
function togglePlaylistExpansion(playlistId) {
  const playlistCard = document.querySelector(`[data-playlist-id="${playlistId}"]`);
  if (!playlistCard) return;
  
  const videoGrid = playlistCard.querySelector('.video-grid');
  const isExpanded = playlistCard.classList.contains('expanded');
  
  // Close all other expanded playlists first
  document.querySelectorAll('.playlist-card.expanded').forEach(card => {
    if (card !== playlistCard) {
      card.classList.remove('expanded');
      const otherVideoGrid = card.querySelector('.video-grid');
      if (otherVideoGrid) {
        otherVideoGrid.style.display = 'none';
      }
    }
  });
  
  if (isExpanded) {
    // Collapse playlist
    playlistCard.classList.remove('expanded');
    if (videoGrid) {
      videoGrid.style.display = 'none';
    }
  } else {
    // Expand playlist
    playlistCard.classList.add('expanded');
    if (videoGrid) {
      videoGrid.style.display = 'block';
    }
    
    // Smooth scroll to the expanded playlist
    setTimeout(() => {
      playlistCard.scrollIntoView({ 
        behavior: 'smooth', 
        block: 'start',
        inline: 'nearest'
      });
    }, 100);
  }
}

function showLoading() {
  const playlistsGrid = document.getElementById('playlistsGrid');
  const loadingDiv = document.createElement('div');
  loadingDiv.id = 'loading-indicator';
  loadingDiv.className = 'loading';
  loadingDiv.innerHTML = '<div class="spinner"></div>Loading playlist...';
  playlistsGrid.appendChild(loadingDiv);
}

function hideLoading() {
  const loadingIndicator = document.getElementById('loading-indicator');
  if (loadingIndicator) {
    loadingIndicator.remove();
  }
}

function showError(message) {
  const playlistsGrid = document.getElementById('playlistsGrid');
  const errorDiv = document.createElement('div');
  errorDiv.className = 'error-message';
  errorDiv.innerHTML = `
    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px; vertical-align: middle;">
      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
    </svg>
    ${message}
  `;
  playlistsGrid.appendChild(errorDiv);
  
  setTimeout(() => {
    errorDiv.style.animation = 'slideInLeft 0.3s ease-out reverse';
    setTimeout(() => errorDiv.remove(), 300);
  }, 5000);
}

function showSuccess(message) {
  const playlistsGrid = document.getElementById('playlistsGrid');
  const successDiv = document.createElement('div');
  successDiv.className = 'success-message';
  successDiv.innerHTML = `
    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px; vertical-align: middle;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    ${message}
  `;
  playlistsGrid.appendChild(successDiv);
  
  setTimeout(() => {
    successDiv.style.animation = 'slideInLeft 0.3s ease-out reverse';
    setTimeout(() => successDiv.remove(), 300);
  }, 3000);
}

// Search functionality
function initializeSearch() {
  const searchForm = document.getElementById('searchForm');
  const searchBtn = document.getElementById('searchBtn');
  const searchInput = document.getElementById('searchInput');
  const engines = document.querySelectorAll('.engine');

  let currentEngine = 'bing';

  engines.forEach(engine => {
    engine.addEventListener('click', () => {
      engines.forEach(e => e.classList.remove('active'));
      engine.classList.add('active');
      currentEngine = engine.dataset.engine;
    });
  });

  function performSearch() {
    const query = searchInput.value.trim();
    if (!query) return;

    const searchUrls = {
      google: `https://www.google.com/search?q=${encodeURIComponent(query)}`,
      bing: `https://www.bing.com/search?q=${encodeURIComponent(query)}`,
      chatgpt: `https://chat.openai.com/?q=${encodeURIComponent(query)}`,
      copilot: `https://copilot.microsoft.com/?q=${encodeURIComponent(query)}`
    };

    window.open(searchUrls[currentEngine], '_blank');
  }

  searchForm.addEventListener('submit', (e) => {
    e.preventDefault();
    performSearch();
  });

  searchBtn.addEventListener('click', performSearch);
}

// Quick Links functionality
function loadQuickLinks() {
  let links = JSON.parse(localStorage.getItem('quickLinks') || '[]');
  
  // Add default links if none exist
  if (links.length === 0) {
    const defaultLinks = [
      { name: 'YouTube', url: 'https://youtube.com', description: 'Video platform' },
      { name: 'GitHub', url: 'https://github.com', description: 'Code hosting' },
      { name: 'Gmail', url: 'https://gmail.com', description: 'Email service' },
      { name: 'Netflix', url: 'https://netflix.com', description: 'Streaming' }
    ];
    
    links = defaultLinks;
    localStorage.setItem('quickLinks', JSON.stringify(defaultLinks));
  }
  
  const tilesContainer = document.getElementById('linkTiles');
  const addTile = tilesContainer.querySelector('.add-tile');
  
  // Clear existing tiles except add button
  const existingTiles = tilesContainer.querySelectorAll('.tile-ring');
  existingTiles.forEach(tile => tile.remove());

  links.forEach((link, index) => {
    const tileElement = createLinkTile(link, index);
    tilesContainer.insertBefore(tileElement, addTile);
  });
}

function createLinkTile(link, index) {
  const tileRing = document.createElement('a');
  tileRing.className = 'tile-ring';
  tileRing.href = link.url;
  tileRing.target = '_blank';
  
  tileRing.innerHTML = `
    <div class="tile">
      <div class="meta">
        <div class="name">${link.name}</div>
        <div class="desc">${link.description || 'Quick link'}</div>
      </div>
    </div>
    <button class="delete-btn" onclick="event.preventDefault(); deleteQuickLink(${index})">×</button>
  `;
  
  return tileRing;
}

function showAddLinkModal() {
  document.getElementById('addLinkModal').classList.add('show');
}

function hideAddLinkModal() {
  document.getElementById('addLinkModal').classList.remove('show');
  document.getElementById('addLinkForm').reset();
}

function deleteQuickLink(index) {
  const links = JSON.parse(localStorage.getItem('quickLinks') || '[]');
  links.splice(index, 1);
  localStorage.setItem('quickLinks', JSON.stringify(links));
  loadQuickLinks();
}

// Add link form handler
document.getElementById('addLinkForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const name = document.getElementById('linkName').value;
  const url = document.getElementById('linkUrl').value;
  const description = document.getElementById('linkDesc').value;
  
  const links = JSON.parse(localStorage.getItem('quickLinks') || '[]');
  links.push({ name, url, description });
  localStorage.setItem('quickLinks', JSON.stringify(links));
  
  hideAddLinkModal();
  loadQuickLinks();
});

// Background animation
function initBackgroundAnimation() {
  const canvas = document.getElementById('bg');
  const ctx = canvas.getContext('2d');
  let particles = [];
  let animationFrameId = null;

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    initParticles();
  }

  function initParticles() {
    const colors = [180, 200, 250, 300];
    const particleCount = Math.min(40, Math.floor((window.innerWidth * window.innerHeight) / 20000));
    
    particles = Array.from({length: particleCount}, () => ({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: 30 + Math.random() * 50,
      dx: (Math.random() - 0.5) * 0.4,
      dy: (Math.random() - 0.5) * 0.4,
      h: colors[Math.floor(Math.random() * colors.length)]
    }));
  }

  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    for (let i = 0; i < particles.length; i++) {
      const p = particles[i];
      
      // Update position
      p.x += p.dx;
      p.y += p.dy;
      
      // Create gradient
      const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r);
      gradient.addColorStop(0, `hsla(${p.h},100%,60%,.25)`);
      gradient.addColorStop(1, 'transparent');
      
      // Draw particle
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fill();
      
      // Wrap around screen edges
      if (p.x < -p.r) p.x = canvas.width + p.r;
      if (p.x > canvas.width + p.r) p.x = -p.r;
      if (p.y < -p.r) p.y = canvas.height + p.r;
      if (p.y > canvas.height + p.r) p.y = -p.r;
    }
    
    animationFrameId = requestAnimationFrame(animate);
  }

  // Initialize
  resizeCanvas();
  animate();
  
  // Handle resize
  window.addEventListener('resize', resizeCanvas);
  
  // Handle visibility change for performance
  document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
      if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
        animationFrameId = null;
      }
    } else {
      if (!animationFrameId) {
        animate();
      }
    }
  });
}

// User Playlist Functions
function playUserPlaylist(index) {
  const savedPlaylists = JSON.parse(localStorage.getItem('userPlaylists') || '[]');
  const playlist = savedPlaylists[index];
  
  if (!playlist || !playlist.videos || playlist.videos.length === 0) {
    showError('No songs in this playlist');
    return;
  }
  
  // Start playing from first video
  playVideoFromUserPlaylist(index, 0);
}

function playVideoFromUserPlaylist(playlistIndex, videoIndex) {
  const savedPlaylists = JSON.parse(localStorage.getItem('userPlaylists') || '[]');
  const playlist = savedPlaylists[playlistIndex];
  
  if (!playlist || !playlist.videos || !playlist.videos[videoIndex]) {
    showError('Video not found');
    return;
  }
  
  const video = playlist.videos[videoIndex];
  const videoId = video.id;
  
  if (!videoId) {
    showError('Invalid video ID');
    return;
  }
  
  // Set current playlist context
  currentPlaylist = playlist.videos;
  currentVideoIndex = videoIndex;
  currentVideoId = videoId;
  
  // Start playing the video
  if (isPlayerReady) {
    youtubePlayer.loadVideoById(videoId);
    
    // Show music player
    const musicPlayer = document.getElementById('musicPlayer');
    if (musicPlayer) {
      musicPlayer.style.display = 'block';
      musicPlayer.classList.add('show');
    }
    
    showSuccess(`Playing: ${video.title}`);
  } else {
    showError('Player not ready. Please try again.');
  }
}

// Initialize YouTube API when page loads
loadYouTubeAPI();

// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  console.log('YouTube player ready');
  onYouTubeIframeAPIReady();
  initializeSearch();
  loadQuickLinks();
  loadPlaylists();
  initializePlaylistScrolling();
  
  // Initialize playlist input functionality
  const playlistBtn = document.getElementById('playlistBtn');
  const playlistInput = document.getElementById('playlistUrl');
  
  playlistBtn.addEventListener('click', handlePlaylistInput);
  playlistInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      handlePlaylistInput();
    }
  });
});

// Initialize playlist scrolling indicator
function initializePlaylistScrolling() {
  const playlistGrid = document.getElementById('playlistsGrid');
  const container = playlistGrid.parentElement;
  
  function checkScrollable() {
    if (playlistGrid.scrollHeight > playlistGrid.clientHeight) {
      container.classList.add('scrollable');
    } else {
      container.classList.remove('scrollable');
    }
  }
  
  // Check scrollable state when playlists are loaded
  const observer = new MutationObserver(checkScrollable);
  observer.observe(playlistGrid, { childList: true, subtree: true });
  
  // Initial check
  setTimeout(checkScrollable, 100);
}

// Close player function
function closePlayer() {
  const musicPlayer = document.getElementById('musicPlayer');
  if (musicPlayer) {
    musicPlayer.style.display = 'none';
  }
  
  // Stop the current video
  if (youtubePlayer && typeof youtubePlayer.stopVideo === 'function') {
    youtubePlayer.stopVideo();
  }
  
  // Clear current playing state but keep playlist intact for resume
  isPlayerVisible = false;
  isPlaying = false;
  
  // Reset UI to default state
  document.getElementById('currentTitle').textContent = 'No track selected';
  document.getElementById('currentChannel').textContent = 'Select a video to play';
  
  const thumbnail = document.getElementById('currentThumbnail');
  if (thumbnail) {
    thumbnail.style.backgroundImage = '';
    thumbnail.style.background = 'linear-gradient(45deg, #6c5ce7, #a29bfe)';
  }
  
  // Reset play button to play state
  const playBtn = document.getElementById('playPauseBtn');
  if (playBtn) {
    playBtn.innerHTML = `
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M8 5v14l11-7z"/>
      </svg>
    `;
  }
  
  // Clear playing states
  document.querySelectorAll('.video-tile').forEach(tile => {
    tile.classList.remove('playing');
  });
}

// Delete playlist function
function deletePlaylist(playlistId) {
  if (confirm('Are you sure you want to delete this playlist?')) {
    const savedPlaylists = JSON.parse(localStorage.getItem('userPlaylists') || '[]');
    const updatedPlaylists = savedPlaylists.filter(p => p.id !== playlistId);
    localStorage.setItem('userPlaylists', JSON.stringify(updatedPlaylists));
    loadUserPlaylists();
    showSuccess('Playlist deleted successfully');
  }
}
</script>
</body>
</html>