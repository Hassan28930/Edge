<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>New tab</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-1: #0b1020;
      --muted: #9aa8c7;
      --accent: #6ad0ff;
      --ui-radius: 28px;
      --tab-height: 78px;
    }
    
    html,body{
      height:100%;
      margin:0;
      font-family:Inter,system-ui;
      background:var(--bg-1);
      color:#e9f2ff;
      overflow:hidden;
    }
    
    #bg{
      position:fixed;
      inset:0;
      z-index:0;
      will-change: auto;
    }
    
    .container{
      position:relative;
      z-index:3;
      max-width:980px;
      margin:28px auto;
      padding:24px;
      display:flex;
      flex-direction:column;
      gap:20px;
    }

    .card{
      background:rgba(255,255,255,0.02);
      border-radius:var(--ui-radius);
      backdrop-filter:blur(8px);
      box-shadow:0 8px 24px rgba(2,8,20,.6);
      padding:18px;
    }

    .rgb-anim {
      position: relative;
      border-radius: 20px;
      padding: 3px;
      background: linear-gradient(135deg, #00f0ff, #9b6bff, #ff4fd8, #00f0ff);
      background-size: 300% 300%;
      animation: gradientShift 8s ease infinite;
      will-change: background-position;
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Search */
    .search-bar {
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:20px;
    }
    
    .search {
      flex:1;
      display:flex;
      align-items:center;
      background:rgba(15,15,20,0.9);
      padding:10px 14px;
      border-radius:14px;
      transition:transform .3s ease, box-shadow .3s ease;
      will-change: transform;
    }
    
    .search:hover {
      transform:translateY(-3px) scale(1.01);
      box-shadow:0 12px 28px rgba(0,255,200,0.3);
    }
    
    .search input{
      flex:1;
      background:transparent;
      border:0;
      color:inherit;
      font-size:16px;
      outline:none;
    }
    
    .btn{
      background:linear-gradient(180deg,var(--accent),#33c3ff);
      color:#05202a;
      padding:10px 14px;
      border-radius:12px;
      font-weight:700;
      border:0;
      cursor:pointer;
      margin-left:12px;
      transition:transform .2s;
      will-change: transform;
    }
    
    .btn:active{
      transform:scale(0.92);
    }

    /* Engine Selector */
    .engines{
      display:flex;
      gap:10px;
      margin-top:10px;
      flex-wrap:wrap;
    }
    
    .engine {
      flex:1;
      min-width:120px;
      background:rgba(255,255,255,0.05);
      border-radius:14px;
      padding:10px;
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:center;
      cursor:pointer;
      transition:transform .25s ease, box-shadow .3s ease;
      will-change: transform;
    }
    
    .engine:hover {
      transform:translateY(-6px) scale(1.05);
      box-shadow:0 12px 24px rgba(0,200,255,.4);
    }
    
    .engine:active {
      transform:scale(0.92);
    }
    
    .engine.active {
      background:linear-gradient(135deg,#9ff2ff,#55d3ff);
      color:#05202a;
      font-weight:700;
    }
    
    .engine svg{
      width:22px;
      height:22px;
      flex-shrink:0;
    }

    /* Quick Links */
    .tiles{
      display:flex;
      gap:14px;
      margin-top:16px;
      flex-wrap:wrap;
      align-items:center;
    }
    
    .add-tile {
      min-width:150px;
      background:rgba(255,255,255,0.05);
      border-radius:14px;
      padding:12px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition:transform .25s ease, box-shadow .3s ease;
      border:2px dashed rgba(255,255,255,0.2);
      color:var(--muted);
      will-change: transform;
    }
    
    .add-tile:hover {
      transform:translateY(-6px) scale(1.05);
      box-shadow:0 12px 24px rgba(0,200,255,.3);
      border-color:var(--accent);
      color:#fff;
    }
    
    .add-tile svg {
      width:24px;
      height:24px;
      flex-shrink:0;
    }
    
    /* Modal Styles */
    .modal-overlay {
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.7);
      display:none;
      justify-content:center;
      align-items:center;
      z-index:1000;
      backdrop-filter:blur(8px);
    }
    
    .modal-overlay.show {
      display:flex;
    }
    
    .modal {
      background:rgba(15,15,25,0.95);
      border-radius:var(--ui-radius);
      padding:24px;
      width:min(400px, 90%);
      border:1px solid rgba(255,255,255,0.1);
      box-shadow:0 20px 40px rgba(0,0,0,0.5);
    }
    
    .modal h3 {
      margin:0 0 20px 0;
      color:#fff;
    }
    
    .modal-form {
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    
    .form-group {
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    
    .form-group label {
      color:var(--muted);
      font-size:14px;
      font-weight:600;
    }
    
    .form-group input {
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.1);
      border-radius:8px;
      padding:12px;
      color:#fff;
      font-size:14px;
    }
    
    .form-group input:focus {
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 2px rgba(106,208,255,0.2);
    }
    
    .modal-buttons {
      display:flex;
      gap:12px;
      justify-content:flex-end;
      margin-top:8px;
    }
    
    .modal-btn {
      padding:10px 20px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-weight:600;
      transition:transform .2s;
    }
    
    .modal-btn.primary {
      background:linear-gradient(180deg,var(--accent),#33c3ff);
      color:#05202a;
    }
    
    .modal-btn.secondary {
      background:rgba(255,255,255,0.1);
      color:#fff;
    }
    
    .modal-btn:hover {
      transform:scale(1.05);
    }
    
    .modal-btn:active {
      transform:scale(0.95);
    }
    
    .delete-btn {
      position:absolute;
      top:8px;
      right:8px;
      background:rgba(255,59,48,0.8);
      border:none;
      border-radius:50%;
      width:24px;
      height:24px;
      cursor:pointer;
      display:none;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-size:12px;
      transition:transform .2s;
    }
    
    .tile-ring:hover .delete-btn {
      display:flex;
    }
    
    .delete-btn:hover {
      transform:scale(1.1);
      background:rgba(255,59,48,1);
    }
    
    .tile-ring {
      border-radius:16px;
      padding:3px;
      background: linear-gradient(135deg, #00f0ff, #9b6bff, #ff4fd8, #00f0ff);
      background-size: 300% 300%;
      animation: gradientShift 8s ease infinite;
      will-change: background-position;
      text-decoration: none;
      position: relative;
    }
    
    .tile {
      min-width:150px;
      background:rgba(255,255,255,0.05);
      border-radius:14px;
      padding:12px;
      display:flex;
      gap:10px;
      align-items:center;
      transition:transform .25s ease, box-shadow .3s ease;
      transform-style:preserve-3d;
      will-change: transform;
    }
    
    .tile:hover{
      transform:translateY(-10px) rotateX(6deg) rotateY(-6deg) scale(1.05);
      box-shadow:0 20px 40px rgba(0,200,255,.35);
    }
    
    .tile:active{
      transform:scale(0.92);
    }
    
    .tile svg{
      width:38px;
      height:38px;
      flex-shrink:0;
      filter:drop-shadow(0 0 6px rgba(255,255,255,0.2));
    }
    
    .tile .meta{
      display:flex;
      flex-direction:column;
    }
    
    .tile .meta .name{
      font-weight:700;
      color: inherit;
    }
    
    .tile .meta .desc{
      font-size:12px;
      color:var(--muted);
    }

    /* Tabbar */
    .tabbar-wrap {
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:18px;
      border-radius:44px;
      z-index:6;
      padding:3px;
      background: linear-gradient(135deg, #00f0ff, #9b6bff, #ff4fd8, #00f0ff);
      background-size: 300% 300%;
      animation: gradientShift 8s ease infinite;
      will-change: background-position;
    }
    
    .tabbar {
      height:var(--tab-height);
      width:min(760px,calc(100% - 40px));
      background:rgba(255,255,255,.02);
      border-radius:40px;
      display:flex;
      align-items:center;
      justify-content:space-around;
      padding:12px 18px;
      border:1px solid rgba(255,255,255,.05);
      box-shadow:0 12px 40px rgba(2,7,20,.6);
    }
    
    .tab{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
      color:var(--muted);
      font-size:12px;
      cursor:pointer;
      padding:8px 12px;
      transition:.25s;
      will-change: transform;
    }
    
    .tab:hover{
      transform:translateY(-6px) scale(1.08);
      color:#fff;
    }
    
    .tab:active{
      transform:scale(0.92);
    }
    
    .tab.active{
      color:#061e25;
      background:linear-gradient(180deg,#9ff2ff,#55d3ff);
      transform:translateY(-8px) scale(1.1);
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
      .container {
        margin: 16px auto;
        padding: 16px;
      }
      
      .tiles {
        justify-content: center;
      }
      
      .tile {
        min-width: 140px;
      }
      
      .engines {
        justify-content: center;
      }
      
      .engine {
        min-width: 100px;
      }
    }

    @media (max-width: 480px) {
      .search-bar {
        flex-direction: column;
        gap: 12px;
      }
      
      .btn {
        margin-left: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>
<canvas id="bg"></canvas>
<div class="container">
  <div class="card">
    <h2>Search the web</h2>

    <!-- Search -->
    <div class="search-bar">
      <form id="searchForm" class="search">
        <input name="q" id="searchInput" type="search" placeholder="Search..." autocomplete="off">
      </form>
      <button id="searchBtn" class="btn" type="button">Go</button>
    </div>

    <!-- Engine Selector -->
    <div class="engines">
      <div class="engine active" data-engine="bing" role="button" tabindex="0">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#008373" d="M2 3l7 3v8l5 3 5-3V3H2z"/></svg>Bing
      </div>
      <div class="engine" data-engine="google" role="button" tabindex="0">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#4285F4" d="M21.35 11.1h-9.17v2.92h5.42c-.24 1.47-1.63 4.31-5.42 4.31-3.26 0-5.92-2.7-5.92-6.04 0-3.34 2.66-6.04 5.92-6.04 1.86 0 3.1.79 3.82 1.48l2.61-2.52C17.55 3.42 15.05 2.2 12.18 2.2 7.08 2.2 3 6.28 3 11.38c0 5.1 4.08 9.18 9.18 9.18 5.3 0 8.82-3.73 8.82-9.04 0-.6-.07-1.04-.16-1.42z"/></svg>Google
      </div>
      <div class="engine" data-engine="chatgpt" role="button" tabindex="0">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#10a37f" d="M12 2a10 10 0 100 20 10 10 0 000-20z"/></svg>ChatGPT
      </div>
      <div class="engine" data-engine="copilot" role="button" tabindex="0">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#6a5acd" d="M12 2l9 7v6l-9 7-9-7V9l9-7z"/></svg>Copilot
      </div>
    </div>

    <!-- Quick Links -->
    <div class="tiles" id="tilesContainer">
      <a class="tile-ring" href="https://www.youtube.com" target="_blank" rel="noopener noreferrer">
        <div class="tile">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#FF0000" d="M23.5 6.2s-.2-1.6-.8-2.3c-.7-.8-1.6-.9-2-1C17.6 2.5 12 2.5 12 2.5h0s-5.6 0-8.7.4c-.4 0-1.3.1-2 1-.6.7-.8 2.3-.8 2.3S0 8.3 0 10.4v1.1c0 2.1.2 4.2.2 4.2s.2 1.6.8 2.3c.7.8 1.6.9 2 1 3.1.4 8.7.4 8.7.4s5.6 0 8.7-.4c.4 0 1.3-.1 2-1 .6-.7.8-2.3.8-2.3s.2-2.1.2-4.2v-1.1c0-2.1-.2-4.2-.2-4.2z"/><path fill="#fff" d="M9.7 15.5V8.5l6.2 3.5-6.2 3.5z"/></svg>
          <div class="meta">
            <div class="name">YouTube</div>
            <div class="desc">Videos</div>
          </div>
        </div>
      </a>
      <a class="tile-ring" href="https://mail.google.com" target="_blank" rel="noopener noreferrer">
        <div class="tile">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#EA4335" d="M12 13.2L2 6.7V18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6.7l-10 6.5z"/><path fill="#4285F4" d="M22 4H2l10 7 10-7z"/></svg>
          <div class="meta">
            <div class="name">Gmail</div>
            <div class="desc">Email</div>
          </div>
        </div>
      </a>
      <a class="tile-ring" href="https://www.binance.com" target="_blank" rel="noopener noreferrer">
        <div class="tile">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#f3ba2f" d="M12 2.25l2.122 2.122-2.122 2.122-2.122-2.122L12 2.25zm5.628 3.75l2.122 2.122-2.122 2.122-2.122-2.122 2.122-2.122zM6.372 6l2.122 2.122-2.122 2.122-2.122-2.122L6.372 6zm5.628 3.75l2.122 2.122-2.122 2.122-2.122-2.122L12 9.75zm0 5.25l2.122 2.122-2.122 2.122-2.122-2.122L12 15z"/></svg>
          <div class="meta">
            <div class="name">Binance</div>
            <div class="desc">Exchange</div>
          </div>
        </div>
      </a>
      <a class="tile-ring" href="https://www.instagram.com" target="_blank" rel="noopener noreferrer">
        <div class="tile">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#E1306C" d="M7 2C4.2 2 2 4.2 2 7v10c0 2.8 2.2 5 5 5h10c2.8 0 5-2.2 5-5V7c0-2.8-2.2-5-5-5H7zm10 2c1.7 0 3 1.3 3 3v10c0 1.7-1.3 3-3 3H7c-1.7 0-3-1.3-3-3V7c0-1.7 1.3-3 3-3h10zm-5 3a5 5 0 100 10 5 5 0 000-10zm0 2a3 3 0 110 6 3 3 0 010-6zm5.5-.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"/></svg>
          <div class="meta">
            <div class="name">Instagram</div>
            <div class="desc">Reels</div>
          </div>
        </div>
      </a>
      
      <!-- Add Link Button -->
      <div class="add-tile" id="addTileBtn" role="button" tabindex="0">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
        </svg>
        <span>Add Link</span>
      </div>
    </div>

  </div>
</div>

<!-- Add Link Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <h3>Add Quick Link</h3>
    <form class="modal-form" id="addLinkForm">
      <div class="form-group">
        <label for="linkName">Name</label>
        <input type="text" id="linkName" placeholder="Enter link name" required>
      </div>
      <div class="form-group">
        <label for="linkUrl">URL</label>
        <input type="url" id="linkUrl" placeholder="https://example.com" required>
      </div>
      <div class="form-group">
        <label for="linkDesc">Description</label>
        <input type="text" id="linkDesc" placeholder="Brief description" required>
      </div>
      <div class="modal-buttons">
        <button type="button" class="modal-btn secondary" id="cancelBtn">Cancel</button>
        <button type="submit" class="modal-btn primary">Add Link</button>
      </div>
    </form>
  </div>
</div>

<script>
(function() {
  'use strict';
  
  // Cache DOM elements for better performance
  const elements = {
    searchForm: document.getElementById('searchForm'),
    searchInput: document.getElementById('searchInput'),
    searchBtn: document.getElementById('searchBtn'),
    engines: document.querySelectorAll('.engine'),
    canvas: document.getElementById('bg'),
    tilesContainer: document.getElementById('tilesContainer'),
    addTileBtn: document.getElementById('addTileBtn'),
    modalOverlay: document.getElementById('modalOverlay'),
    addLinkForm: document.getElementById('addLinkForm'),
    cancelBtn: document.getElementById('cancelBtn'),
    linkName: document.getElementById('linkName'),
    linkUrl: document.getElementById('linkUrl'),
    linkDesc: document.getElementById('linkDesc')
  };
  
  // Application state
  let selectedEngine = "bing";
  let animationFrameId = null;
  let resizeTimeoutId = null;
  let customLinks = [];
  
  // Search engine URLs with proper error handling
  const searchEngines = {
    bing: (q) => `https://www.bing.com/search?q=${encodeURIComponent(q)}`,
    google: (q) => `https://www.google.com/search?q=${encodeURIComponent(q)}`,
    chatgpt: (q) => `https://chat.openai.com/?q=${encodeURIComponent(q)}`,
    copilot: (q) => `https://copilot.microsoft.com/?q=${encodeURIComponent(q)}`
  };
  
  // Optimized search function
  function performSearch() {
    const query = elements.searchInput.value.trim();
    if (!query) {
      elements.searchInput.focus();
      return;
    }
    
    try {
      const urlGenerator = searchEngines[selectedEngine];
      if (urlGenerator) {
        const url = urlGenerator(query);
        window.open(url, '_blank', 'noopener,noreferrer');
      } else {
        console.error('Unknown search engine:', selectedEngine);
      }
    } catch (error) {
      console.error('Search error:', error);
    }
  }
  
  // Engine selector with improved accessibility
  function initEngineSelector() {
    elements.engines.forEach(engine => {
      function selectEngine() {
        // Remove active class from all engines
        elements.engines.forEach(e => e.classList.remove('active'));
        // Add active class to selected engine
        engine.classList.add('active');
        selectedEngine = engine.dataset.engine;
      }
      
      // Mouse events
      engine.addEventListener('click', selectEngine);
      
      // Keyboard events for accessibility
      engine.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          selectEngine();
        }
      });
    });
  }
  
  // Search event handlers
  function initSearch() {
    // Form submission (Enter key)
    elements.searchForm.addEventListener('submit', (e) => {
      e.preventDefault();
      performSearch();
    });
    
    // Button click
    elements.searchBtn.addEventListener('click', performSearch);
    
    // Focus search input on page load
    elements.searchInput.focus();
  }
  
  // Custom links management
  function loadCustomLinks() {
    try {
      const stored = localStorage.getItem('customQuickLinks');
      customLinks = stored ? JSON.parse(stored) : [];
      renderCustomLinks();
    } catch (error) {
      console.error('Error loading custom links:', error);
      customLinks = [];
    }
  }
  
  function saveCustomLinks() {
    try {
      localStorage.setItem('customQuickLinks', JSON.stringify(customLinks));
    } catch (error) {
      console.error('Error saving custom links:', error);
    }
  }
  
  function createCustomLinkElement(link, index) {
    const linkElement = document.createElement('a');
    linkElement.className = 'tile-ring';
    linkElement.href = link.url;
    linkElement.target = '_blank';
    linkElement.rel = 'noopener noreferrer';
    linkElement.dataset.customIndex = index;
    
    linkElement.innerHTML = `
      <div class="tile">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path fill="${link.color || '#6ad0ff'}" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        <div class="meta">
          <div class="name">${escapeHtml(link.name)}</div>
          <div class="desc">${escapeHtml(link.description)}</div>
        </div>
      </div>
      <button class="delete-btn" data-index="${index}" title="Remove link">&times;</button>
    `;
    
    return linkElement;
  }
  
  function renderCustomLinks() {
    // Remove existing custom links
    const existingCustomLinks = elements.tilesContainer.querySelectorAll('[data-custom-index]');
    existingCustomLinks.forEach(link => link.remove());
    
    // Add custom links before the add button
    const addButton = elements.addTileBtn;
    customLinks.forEach((link, index) => {
      const linkElement = createCustomLinkElement(link, index);
      elements.tilesContainer.insertBefore(linkElement, addButton);
    });
    
    // Add delete button event listeners
    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        const index = parseInt(btn.dataset.index);
        deleteCustomLink(index);
      });
    });
  }
  
  function deleteCustomLink(index) {
    if (confirm('Remove this quick link?')) {
      customLinks.splice(index, 1);
      saveCustomLinks();
      renderCustomLinks();
    }
  }
  
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
  
  function showModal() {
    elements.modalOverlay.classList.add('show');
    elements.linkName.focus();
  }
  
  function hideModal() {
    elements.modalOverlay.classList.remove('show');
    elements.addLinkForm.reset();
  }
  
  function initCustomLinks() {
    // Load existing custom links
    loadCustomLinks();
    
    // Add tile button
    elements.addTileBtn.addEventListener('click', showModal);
    elements.addTileBtn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        showModal();
      }
    });
    
    // Modal controls
    elements.cancelBtn.addEventListener('click', hideModal);
    elements.modalOverlay.addEventListener('click', (e) => {
      if (e.target === elements.modalOverlay) {
        hideModal();
      }
    });
    
    // Form submission
    elements.addLinkForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const name = elements.linkName.value.trim();
      const url = elements.linkUrl.value.trim();
      const description = elements.linkDesc.value.trim();
      
      if (!name || !url || !description) {
        alert('Please fill in all fields');
        return;
      }
      
      // Validate URL
      try {
        new URL(url);
      } catch (error) {
        alert('Please enter a valid URL');
        elements.linkUrl.focus();
        return;
      }
      
      // Add the new link
      const newLink = {
        name,
        url,
        description,
        color: `hsl(${Math.floor(Math.random() * 360)}, 70%, 60%)`,
        id: Date.now()
      };
      
      customLinks.push(newLink);
      saveCustomLinks();
      renderCustomLinks();
      hideModal();
    });
    
    // Escape key to close modal
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && elements.modalOverlay.classList.contains('show')) {
        hideModal();
      }
    });
  }
  
  // Optimized background animation
  function initBackgroundAnimation() {
    const ctx = elements.canvas.getContext('2d');
    let particles = [];
    
    // Debounced resize function
    function handleResize() {
      if (resizeTimeoutId) {
        clearTimeout(resizeTimeoutId);
      }
      
      resizeTimeoutId = setTimeout(() => {
        elements.canvas.width = window.innerWidth;
        elements.canvas.height = window.innerHeight;
        
        // Recreate particles for new dimensions
        initParticles();
      }, 100);
    }
    
    function initParticles() {
      const colors = [180, 200, 250, 300];
      const particleCount = Math.min(40, Math.floor((window.innerWidth * window.innerHeight) / 20000));
      
      particles = Array.from({length: particleCount}, () => ({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight,
        r: 30 + Math.random() * 50,
        dx: (Math.random() - 0.5) * 0.4,
        dy: (Math.random() - 0.5) * 0.4,
        h: colors[Math.floor(Math.random() * colors.length)]
      }));
    }
    
    function animate() {
      // Clear canvas efficiently
      ctx.clearRect(0, 0, elements.canvas.width, elements.canvas.height);
      
      // Update and draw particles
      for (let i = 0; i < particles.length; i++) {
        const p = particles[i];
        
        // Update position
        p.x += p.dx;
        p.y += p.dy;
        
        // Create gradient
        const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r);
        gradient.addColorStop(0, `hsla(${p.h},100%,60%,.25)`);
        gradient.addColorStop(1, 'transparent');
        
        // Draw particle
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.fill();
        
        // Wrap around screen edges
        if (p.x < -p.r) p.x = elements.canvas.width + p.r;
        if (p.x > elements.canvas.width + p.r) p.x = -p.r;
        if (p.y < -p.r) p.y = elements.canvas.height + p.r;
        if (p.y > elements.canvas.height + p.r) p.y = -p.r;
      }
      
      animationFrameId = requestAnimationFrame(animate);
    }
    
    // Initialize
    handleResize();
    animate();
    
    // Event listeners
    window.addEventListener('resize', handleResize);
    
    // Cleanup function
    return function cleanup() {
      if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
      }
      if (resizeTimeoutId) {
        clearTimeout(resizeTimeoutId);
      }
      window.removeEventListener('resize', handleResize);
    };
  }
  
  // Page visibility API for performance optimization
  function initVisibilityHandler() {
    function handleVisibilityChange() {
      if (document.hidden) {
        // Pause animations when tab is hidden
        if (animationFrameId) {
          cancelAnimationFrame(animationFrameId);
          animationFrameId = null;
        }
      } else {
        // Resume animations when tab becomes visible
        if (!animationFrameId) {
          initBackgroundAnimation();
        }
      }
    }
    
    document.addEventListener('visibilitychange', handleVisibilityChange);
  }
  
  // Error handling for the entire application
  function initErrorHandling() {
    window.addEventListener('error', (e) => {
      console.error('Application error:', e.error);
    });
    
    window.addEventListener('unhandledrejection', (e) => {
      console.error('Unhandled promise rejection:', e.reason);
    });
  }
  
  // Initialize application
  function init() {
    try {
      initEngineSelector();
      initSearch();
      initCustomLinks();
      initBackgroundAnimation();
      initVisibilityHandler();
      initErrorHandling();
      
      console.log('New tab page initialized successfully');
    } catch (error) {
      console.error('Initialization error:', error);
    }
  }
  
  // Start the application when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
  
  // Cleanup on page unload
  window.addEventListener('beforeunload', () => {
    if (animationFrameId) {
      cancelAnimationFrame(animationFrameId);
    }
    if (resizeTimeoutId) {
      clearTimeout(resizeTimeoutId);
    }
  });
  
})();
</script>
</body>
</html>
